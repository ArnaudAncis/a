\section{Destructors}
\frame{\tableofcontents[currentsection]}

\begin{frame}
  \frametitle{Destructors}
  \begin{center}
    \begin{tabular}{lll}
      & \textbf{Constructor} & \textbf{Destructor} \\
      \toprule
      \textbf{Called} & at creation & on destruction \\
      \textbf{Name} & {\tt classname()} & {\tt \~{}classname()} \\
      \textbf{Parameters} & No restrictions & None \\
      \textbf{Overloads} & Yes & No \\
    \end{tabular}
  \end{center}
  \vskip5mm
  \code[language=c++14,width=.6\linewidth]{destructor.cpp}
\end{frame}

\begin{frame}
  \frametitle{Reason for Destructors}
  \begin{itemize}
    \item Object requires resources (memory, files, \dots)
    \item When object dies, resources need to be freed
    \item Constructor acquires resources
    \item Destructor frees resources
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Destructors in Java}
  \begin{itemize}
    \item Java needs not free memory thanks to garbage collection
    \item Files/streams/\dots need to be released
    \item Java went through several solutions
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Java Approach \#1: {\tt finalize}}
  \begin{itemize}
    \item Object has {\tt finalize} method ({\tt protected})
    \item Can be overriden in subclasses
    \item Called when garbage collector sees object became unreachable
  \end{itemize}
  \vskip5mm
  \structure{Problems}
  \begin{itemize}
    \item Nondeterministic: you never know when the GC will notice object has become unreachable
    \item {\tt finalize()} itself could make the object reachable again
    \item Zombie objects
    \item Do not make use of {\tt finalize}, it's a bad idea
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Java Approach \#2: {\tt close}}
  \begin{itemize}
    \item Object has to be closed manually by calling {\tt close()}
    \item Should be used with {\tt try/finally}
  \end{itemize}
  \vskip5mm
  \structure{Problems}
  \begin{itemize}
    \item Easy to forget
    \item Compiler does not remind you
    \item Consistent naming not enforced (every class can use different name, e.g.\ {\tt close}, {\tt destroy}, {\tt dispose}, \dots)
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Java Approach \#3: {\tt Closeable}}
  \begin{itemize}
    \item Interface with {\tt close} method
    \item \link{https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html}{\tt try-with-resources}
    \item Introduced in Java 7
  \end{itemize}
  \vskip5mm
  \code[language=java,font=\small,width=.9\linewidth]{try-with-resources.java}
\end{frame}

\begin{frame}
  \frametitle{\cpp\ Approach}
  \begin{itemize}
    \item Destructors are similar to {\tt finalize}
    \item Called when object gets destroyed
    \item Important difference: destructors are fully deterministic
  \end{itemize}
  \vskip5mm
  \begin{overprint}
    \onslide<handout:1|1>
    \code[language=c++14,width=.9\linewidth]{out-of-scope.cpp}

    \onslide<handout:2|2>
    \code[language=c++14,width=.9\linewidth]{delete.cpp}

    \onslide<handout:3|3>
    \code[language=c++14,width=.9\linewidth]{delete-array.cpp}

    \onslide<handout:4|4>
    \code[language=c++14,width=.9\linewidth]{pointer-out-of-scope.cpp}
  \end{overprint}
\end{frame}

\begin{frame}
  \frametitle{What To Put In Destructor?}
  \begin{itemize}
    \item Destructor will always implicitly call destructor of each member variable
          (generated by compiler for you)
    \item So don't start calling destructors on each member variable yourself
    \item In fact, never explicitly call a destructor yourself
    \item Only clean up stuff that does not clean itself up
    \item Example: {\tt int*} allocated with {\tt new} needs to be {\tt delete}d in destructor
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Destructors: Example}
  \code[language=c++14,font=\small]{destructor-example.cpp}
\end{frame}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "classes-overview"
%%% End:
